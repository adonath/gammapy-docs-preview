
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maps &#8212; gammapy v0.20.dev703+gba08bf709</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gammapy.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HEALPix-based maps" href="../../maps/hpxmap.html" />
    <link rel="prev" title="Flux point fitting" href="../analysis/1D/sed_fitting.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../userguide/index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../development/index.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../changelog/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        dev  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables tutorials/api/maps and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'url_template': 'https://docs.gammapy.org/{version}/', 'version_match': 'dev'}.
-->

<script type="text/javascript">
// Construct the target URL from the JSON components
function buildURL(entry) {
    var template = "https://docs.gammapy.org/{version}/";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "tutorials/api/maps.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "tutorials/api/maps.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            // get the base URL for that doc version, add the current page's
            // path to it, and set as `href`
            entry.url = buildURL(entry);
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 0.20.dev703+gba08bf709 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "dev") {
                node.classList.add("active");
                $("#version_switcher_button").text(entry.name);
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../userguide/analysis.html">
   Gamma-ray data analysis
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../userguide/package.html">
   Package structure
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/dl3.html">
     Data access and selection (DL3)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/makers.html">
     Data reduction (DL3 to DL4)
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="reference internal" href="../../userguide/dl4.html">
     Datasets (DL4)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/modeling.html">
     Modeling and Fitting (DL4 to DL5)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/hli.html">
     High Level Analysis Interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/catalog.html">
     Source catalogs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/astro.html">
     Astrophysics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/stats.html">
     Statistical utility functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/cli.html">
     Command line tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/visualization.html">
     Plotting features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/utils.html">
     Utility functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../starting/analysis_1.html">
     High level interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../starting/analysis_2.html">
     Low level API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../starting/overview.html">
     Data structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/cta.html">
     CTA with Gammapy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/hess.html">
     H.E.S.S. with Gammapy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/fermi_lat.html">
     Fermi-LAT with Gammapy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/spectral_analysis.html">
     Spectral analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/spectral_analysis_rad_max.html">
     Spectral analysis with energy-dependent directional cuts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/sed_fitting.html">
     Flux point fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/extended_source_spectral_analysis.html">
     Spectral analysis of extended sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/spectrum_simulation.html">
     1D spectrum simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/cta_sensitivity.html">
     Point source sensitivity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/2D/ring_background.html">
     Ring background map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/2D/modeling_2D.html">
     2D map fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/2D/detect.html">
     Source detection and significance maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/cta_data_analysis.html">
     Basic image exploration and fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/analysis_3d.html">
     3D detailed analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/simulate_3d.html">
     3D map simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/analysis_mwl.html">
     Multi instrument joint 3D and 1D analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/event_sampling.html">
     Event sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/flux_profiles.html">
     Flux Profile Estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/light_curve_simulation.html">
     Simulating and fitting a time varying source
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/light_curve.html">
     Light curves
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/light_curve_flare.html">
     Light curves for flares
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/pulsar_analysis.html">
     Pulsar analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="makers.html">
     Makers - Data reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="catalog.html">
     Source catalogs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="models.html">
     Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="model_management.html">
     Modelling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fitting.html">
     Fitting
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mask_maps.html">
     Mask maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="astro_dark_matter.html">
     Dark matter spatial and spectral models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="datasets.html">
     Datasets - Reduced data, IRFs, models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../survey_map.html">
     Survey map
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../userguide/howto.html">
   How To
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../modeling/gallery/index.html">
   Model gallery
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_constant.html">
     Constant spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_disk.html">
     Disk spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_gauss.html">
     Gaussian spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_gen_gauss.html">
     Generalized gaussian spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_point.html">
     Point spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_shell.html">
     Shell spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_shell2.html">
     Shell2 spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_template.html">
     Template spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_absorbed.html">
     EBL absorbption spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_broken_powerlaw.html">
     Broken power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_compound.html">
     Compound spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_constant_spectral.html">
     Constant spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_exp_cutoff_powerlaw.html">
     Exponential cutoff power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_exp_cutoff_powerlaw_3fgl.html">
     Exponential cutoff power law spectral model used for 3FGL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_gauss_spectral.html">
     Gaussian spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_logparabola.html">
     Log parabola spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_naima.html">
     Naima spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_piecewise_norm_spectral.html">
     Piecewise  norm spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_powerlaw.html">
     Power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_powerlaw2.html">
     Power law 2 spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_smooth_broken_powerlaw.html">
     Smooth broken power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_super_exp_cutoff_powerlaw_3fgl.html">
     Super exponential cutoff power law model used for 3FGL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_super_exp_cutoff_powerlaw_4fgl.html">
     Super Exponential Cutoff Power Law Model used for 4FGL-DR3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_super_exp_cutoff_powerlaw_4fgl_dr1.html">
     Super Exponential Cutoff Power Law Model used for 4FGL-DR1 (and DR2)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_template_spectral.html">
     Template spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_constant_temporal.html">
     Constant temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_expdecay_temporal.html">
     ExpDecay temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_gaussian_temporal.html">
     Gaussian temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_generalized_gaussian_temporal.html">
     Generalized Gaussian temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_linear_temporal.html">
     Linear temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_powerlaw_temporal.html">
     PowerLaw temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_sine_temporal.html">
     Sine temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_template_temporal.html">
     Light curve temporal model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://gammapy.github.io/gammapy-recipes">
   Gammapy recipes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../userguide/references.html">
   Glossary and references
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Creating-WCS-Maps">
   Creating WCS Maps
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Using-Factory-Methods">
     Using Factory Methods
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Creating-from-a-Map-Geometry">
     Creating from a Map Geometry
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Adding-Non-Spatial-Axes">
     Adding Non-Spatial Axes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Reading-and-Writing">
   Reading and Writing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Reading-Maps">
     Reading Maps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Writing-Maps">
     Writing Maps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Accessing-Data">
   Accessing Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#How-to-get-data-values">
     How to get data values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Indexing-and-Slicing-Sub-Maps">
     Indexing and Slicing Sub-Maps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Iterating-by-image">
     Iterating by image
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Modifying-Data">
   Modifying Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#How-to-set-data-values">
     How to set data values
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Filling-maps-from-event-lists">
     Filling maps from event lists
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Filling-maps-from-interpolation">
     Filling maps from interpolation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Interpolating-onto-a-different-geometry">
     Interpolating onto a different geometry
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Maps-operations">
   Maps operations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Basic-operators">
     Basic operators
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Cutouts">
     Cutouts
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Visualizing-and-Plotting">
   Visualizing and Plotting
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Image-Plotting">
     Image Plotting
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Cube-plotting">
     Cube plotting
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Maps">
<h1>Maps<a class="headerlink" href="#Maps" title="Permalink to this headline">¶</a></h1>
<img alt="Gammapy Maps Illustration" src="../../_images/gammapy_maps.png" />
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">~gammapy.maps</span></code> submodule contains classes for representing pixilised data on the sky with an arbitrary number of non-spatial dimensions such as energy, time, event class or any possible user-defined dimension (illustrated in the image above). The main <code class="docutils literal notranslate"><span class="pre">Map</span></code> data structure features a uniform API for <a class="reference external" href="https://fits.gsfc.nasa.gov/fits_wcs.html">WCS</a> as well as <a class="reference external" href="https://en.wikipedia.org/wiki/HEALPix">HEALPix</a> based images. The API also generalizes simple image based operations such as
smoothing, interpolation and reprojection to the arbitrary extra dimensions and makes working with (2 + N)-dimensional hypercubes as easy as working with a simple 2D image. Further information is also provided on the <code class="docutils literal notranslate"><span class="pre">~gammapy.maps</span></code> docs page.</p>
<p>In the following introduction we will learn all the basics of working with WCS based maps. HEALPix based maps will be covered in a future tutorial. We will cover the following topics in order:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Creating-WCS-Maps">Creating WCS Maps</a></p></li>
<li><p><a class="reference external" href="#Reading-and-Writing">Reading and Writing</a></p></li>
<li><p><a class="reference external" href="#Accessing-Data">Accessing Data</a></p></li>
<li><p><a class="reference external" href="#Modifying-Data">Modifying Data</a></p></li>
<li><p><a class="reference external" href="#Maps-operations">Maps operations</a></p></li>
<li><p><a class="reference external" href="#Visualizing-and-Plotting">Visualizing and Plotting</a></p></li>
</ol>
<p>Make sure you have worked through the <a class="reference internal" href="../starting/overview.html"><span class="doc">Gammapy overview</span></a>, because a solid knowledge about working with <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> and <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects as well as <a class="reference external" href="http://www.numpy.org/">Numpy</a> is required for this tutorial.</p>
<p>This notebook is rather lengthy, but getting to know the <code class="docutils literal notranslate"><span class="pre">Map</span></code> data structure in detail is essential for working with Gammapy and will allow you to fulfill complex analysis tasks with very few and simple code in future!</p>
</div>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">convolve</span>
<span class="kn">from</span> <span class="nn">gammapy.maps</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">MapAxis</span><span class="p">,</span> <span class="n">WcsGeom</span><span class="p">,</span> <span class="n">WcsNDMap</span>
<span class="kn">from</span> <span class="nn">gammapy.data</span> <span class="kn">import</span> <span class="n">EventList</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Creating-WCS-Maps">
<h2>Creating WCS Maps<a class="headerlink" href="#Creating-WCS-Maps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Using-Factory-Methods">
<h3>Using Factory Methods<a class="headerlink" href="#Using-Factory-Methods" title="Permalink to this headline">¶</a></h3>
<p>Maps are most easily created using the <code class="docutils literal notranslate"><span class="pre">~gammapy.maps.Map.create()</span></code> factory method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_allsky</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">Map.create()</span></code> without any further arguments creates by default an allsky WCS map using a CAR projection, ICRS coordinates and a pixel size of 1 deg. This can be easily checked by printing the <code class="docutils literal notranslate"><span class="pre">.geom</span></code> attribute of the map:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_allsky</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.geom</span></code> attribute is a <code class="docutils literal notranslate"><span class="pre">Geom</span></code> object, that defines the basic geometry of the map, such as size of the pixels, width and height of the image, coordinate system etc., but we will learn more about this object later.</p>
<p>Besides the <code class="docutils literal notranslate"><span class="pre">.geom</span></code> attribute the map has also a <code class="docutils literal notranslate"><span class="pre">.data</span></code> attribute, which is just a plain <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> and stores the data associated with this map:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_allsky</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<p>By default maps are filled with zeros.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">map_type</span></code> argument can be used to control the pixelization scheme (WCS or HPX).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">position</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>

<span class="c1"># Create a WCS Map</span>
<span class="n">m_wcs</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;wcs&quot;</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># Create a HPX Map</span>
<span class="n">m_hpx</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;hpx&quot;</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Here is an example that creates a WCS map centered on the Galactic center and now uses Galactic coordinates:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">m_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">skydir</span><span class="o">=</span><span class="n">skydir</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;TAN&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In addition we have defined a TAN projection, a pixel size of <code class="docutils literal notranslate"><span class="pre">0.02</span></code> deg and a width of the map of <code class="docutils literal notranslate"><span class="pre">10</span> <span class="pre">deg</span> <span class="pre">x</span> <span class="pre">5</span> <span class="pre">deg</span></code>. The <code class="docutils literal notranslate"><span class="pre">width</span></code> argument also takes scalar value instead of a tuple, which is interpreted as both the width and height of the map, so that a quadratic map is created.</p>
</div>
<div class="section" id="Creating-from-a-Map-Geometry">
<h3>Creating from a Map Geometry<a class="headerlink" href="#Creating-from-a-Map-Geometry" title="Permalink to this headline">¶</a></h3>
<p>As we have seen in the first examples, the <code class="docutils literal notranslate"><span class="pre">Map</span></code> object couples the data (stored as a <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>) with a <code class="docutils literal notranslate"><span class="pre">Geom</span></code> object. The <code class="docutils literal notranslate"><span class="pre">Geom</span></code> object can be seen as a generalization of an <code class="docutils literal notranslate"><span class="pre">astropy.wcs.WCS</span></code> object, providing the information on how the data maps to physical coordinate systems. In some cases e.g. when creating many maps with the same WCS geometry it can be advantegeous to first create the map geometry independent of the map object itsself:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wcs_geom</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>And then create the map objects from the <code class="docutils literal notranslate"><span class="pre">wcs_geom</span></code> geometry specification:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;counts&quot;</span><span class="p">,</span> <span class="s2">&quot;background&quot;</span><span class="p">]:</span>
    <span class="n">maps</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_geom</span><span class="p">(</span><span class="n">wcs_geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Geom</span></code> object also has a few helpful methods. E.g. we can check whether a given position on the sky is contained in the map geometry:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the position of the Galactic center and anti-center</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">wcs_geom</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Or get the image center of the map:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wcs_geom</span><span class="o">.</span><span class="n">center_skydir</span>
</pre></div>
</div>
</div>
<p>Or we can also retrieve the solid angle per pixel of the map:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wcs_geom</span><span class="o">.</span><span class="n">solid_angle</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Adding-Non-Spatial-Axes">
<h3>Adding Non-Spatial Axes<a class="headerlink" href="#Adding-Non-Spatial-Axes" title="Permalink to this headline">¶</a></h3>
<p>In many analysis scenarios we would like to add extra dimension to the maps to study e.g. energy or time dependency of the data. Those non-spatial dimensions are handled with the <code class="docutils literal notranslate"><span class="pre">MapAxis</span></code> object. Let us first define an energy axis, with 4 bins:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;TeV&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">energy_axis</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">interp='log'</span></code> specifies that a logarithmic spacing is used between the bins, equivalent to <code class="docutils literal notranslate"><span class="pre">np.logspace(0,</span> <span class="pre">2,</span> <span class="pre">4)</span></code>. This <code class="docutils literal notranslate"><span class="pre">MapAxis</span></code> object we can now pass to <code class="docutils literal notranslate"><span class="pre">Map.create()</span></code> using the <code class="docutils literal notranslate"><span class="pre">axes=</span></code> argument:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_cube</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we see that besides <code class="docutils literal notranslate"><span class="pre">lon</span></code> and <code class="docutils literal notranslate"><span class="pre">lat</span></code> the map has an additional axes named <code class="docutils literal notranslate"><span class="pre">energy</span></code> with 4 bins. The total dimension of the map is now <code class="docutils literal notranslate"><span class="pre">ndim=3</span></code>.</p>
<p>We can also add further axes by passing a list of <code class="docutils literal notranslate"><span class="pre">MapAxis</span></code> objects. To demonstrate this we create a time axis with linearly spaced bins and pass both axes to <code class="docutils literal notranslate"><span class="pre">Map.create()</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;lin&quot;</span>
<span class="p">)</span>

<span class="n">m_4d</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">,</span> <span class="n">time_axis</span><span class="p">]</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_4d</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MapAxis</span></code> object internally stores the coordinates or “position values” associated with every map axis bin or “node”. We distinguish between two node types: <code class="docutils literal notranslate"><span class="pre">edges</span></code> and <code class="docutils literal notranslate"><span class="pre">center</span></code>. The node type <code class="docutils literal notranslate"><span class="pre">edges</span></code>(which is also the default) specifies that the data associated with this axis is integrated between the edges of the bin (e.g. counts data). The node type <code class="docutils literal notranslate"><span class="pre">center</span></code> specifies that the data is given at the center of the bin (e.g. exposure or differential fluxes).</p>
<p>The edges of the bins can be checked with <code class="docutils literal notranslate"><span class="pre">.edges</span></code> attribute:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span><span class="o">.</span><span class="n">edges</span>
</pre></div>
</div>
</div>
<p>The numbers are given in the units we specified above, which can be checked again with:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<p>The centers of the axis bins can be checked with the <code class="docutils literal notranslate"><span class="pre">.center</span></code> attribute:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span><span class="o">.</span><span class="n">center</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Reading-and-Writing">
<h2>Reading and Writing<a class="headerlink" href="#Reading-and-Writing" title="Permalink to this headline">¶</a></h2>
<p>Gammapy <code class="docutils literal notranslate"><span class="pre">Map</span></code> objects are serialized using the Flexible Image Transport Format (FITS). Depending on the pixelisation scheme (HEALPix or WCS) and presence of non-spatial dimensions the actual convention to write the FITS file is different. By default Gammpy uses a generic convention named <code class="docutils literal notranslate"><span class="pre">gadf</span></code>, which will support WCS and HEALPix formats as well as an arbitrary number of non-spatial axes. The convention is documented in detail on the <a class="reference external" href="https://gamma-astro-data-formats.readthedocs.io/en/latest/skymaps/index.html">Gamma Astro Data
Formats</a> page.</p>
<p>Other conventions required by specific software (e.g. the Fermi Science Tools) are supported as well. At the moment those are the following</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fgst-ccube</span></code>: Fermi counts cube format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fgst-ltcube</span></code>: Fermi livetime cube format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fgst-bexpcube</span></code>: Fermi exposure cube format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fgst-template</span></code>: Fermi Galactic diffuse and source template format.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fgst-srcmap</span></code> and <code class="docutils literal notranslate"><span class="pre">fgst-srcmap-sparse</span></code>: Fermi source map and sparse source map format.</p></li>
</ul>
<p>The conventions listed above only support an additional energy axis.</p>
<div class="section" id="Reading-Maps">
<h3>Reading Maps<a class="headerlink" href="#Reading-Maps" title="Permalink to this headline">¶</a></h3>
<p>Reading FITS files is mainly exposed via the <code class="docutils literal notranslate"><span class="pre">Map.read()</span></code> method.Let us take a look at a first example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-counts.fits.gz&quot;</span>
<span class="n">m_3fhl_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_3fhl_gc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">map_type</span></code> argument is not given when calling read a map object will be instantiated with the pixelization of the input HDU.</p>
<p>By default <code class="docutils literal notranslate"><span class="pre">Map.read()</span></code> will try to find the first valid data hdu in the filename and read the data from there. If multiple HDUs are present in the FITS file, the desired one can be chosen with the additional <code class="docutils literal notranslate"><span class="pre">hdu=</span></code> argument:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_3fhl_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_3fhl_gc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In rare cases e.g. when the FITS file is not valid or meta data is missing from the header it can be necessary to modify the header of a certain HDU before creating the <code class="docutils literal notranslate"><span class="pre">Map</span></code> object. In this case we can use <code class="docutils literal notranslate"><span class="pre">astropy.io.fits</span></code> directly to read the FITS file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;GAMMAPY_DATA&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="s2">&quot;/fermi-3fhl-gc/fermi-3fhl-gc-exposure.fits.gz&quot;</span>
<span class="p">)</span>
<span class="n">hdulist</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>And then modify the header keyword and use <code class="docutils literal notranslate"><span class="pre">Map.from_hdulist()</span></code> to create the <code class="docutils literal notranslate"><span class="pre">Map</span></code> object after:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdulist</span><span class="p">[</span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s2">&quot;BUNIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cm2 s&quot;</span>
<span class="n">Map</span><span class="o">.</span><span class="n">from_hdulist</span><span class="p">(</span><span class="n">hdulist</span><span class="o">=</span><span class="n">hdulist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Writing-Maps">
<h3>Writing Maps<a class="headerlink" href="#Writing-Maps" title="Permalink to this headline">¶</a></h3>
<p>Writing FITS files is mainoy exposure via the <code class="docutils literal notranslate"><span class="pre">Map.write()</span></code> method. Here is a first example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;example_cube.fits&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>By default Gammapy does not overwrite files. In this example we set <code class="docutils literal notranslate"><span class="pre">overwrite=True</span></code> in case the cell gets executed multiple times. Now we can read back the cube from disk using <code class="docutils literal notranslate"><span class="pre">Map.read()</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;example_cube.fits&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_cube</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can also choose a different FITS convention to write the example cube in a format compatible to the Fermi Galactic diffuse background model:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;example_cube_fgst.fits&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;fgst-template&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To understand a little bit better the generic <code class="docutils literal notranslate"><span class="pre">gadf</span></code> convention we use <code class="docutils literal notranslate"><span class="pre">Map.to_hdulist()</span></code> to generate a list of FITS HDUs first:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdulist</span> <span class="o">=</span> <span class="n">m_4d</span><span class="o">.</span><span class="n">to_hdulist</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;gadf&quot;</span><span class="p">)</span>
<span class="n">hdulist</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>As we can see the <code class="docutils literal notranslate"><span class="pre">HDUList</span></code> object contains to HDUs. The first one named <code class="docutils literal notranslate"><span class="pre">PRIMARY</span></code> contains the data array with shape corresponding to our data and the WCS information stored in the header:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hdulist</span><span class="p">[</span><span class="s2">&quot;PRIMARY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
</pre></div>
</div>
</div>
<p>The second HDU is a <code class="docutils literal notranslate"><span class="pre">BinTableHDU</span></code> named <code class="docutils literal notranslate"><span class="pre">PRIMARY_BANDS</span></code> contains the information on the non-spatial axes such as name, order, unit, min, max and center values of the axis bins. We use an <code class="docutils literal notranslate"><span class="pre">astropy.table.Table</span></code> to show the information:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">hdulist</span><span class="p">[</span><span class="s2">&quot;PRIMARY_BANDS&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Maps can be serialized to a sparse data format by calling write with <code class="docutils literal notranslate"><span class="pre">sparse=True</span></code>. This will write all non-zero pixels in the map to a data table appropriate to the pixelization scheme.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;wcs&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;file.fits&quot;</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s2">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;file.fits&quot;</span><span class="p">,</span> <span class="n">hdu</span><span class="o">=</span><span class="s2">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="n">map_type</span><span class="o">=</span><span class="s2">&quot;wcs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Accessing-Data">
<h2>Accessing Data<a class="headerlink" href="#Accessing-Data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="How-to-get-data-values">
<h3>How to get data values<a class="headerlink" href="#How-to-get-data-values" title="Permalink to this headline">¶</a></h3>
<p>All map objects have a set of accessor methods, which can be used to access or update the contents of the map irrespective of its underlying representation. Those accessor methods accept as their first argument a coordinate <code class="docutils literal notranslate"><span class="pre">tuple</span></code> containing scalars, <code class="docutils literal notranslate"><span class="pre">list</span></code>, or <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> with one tuple element for each dimension. Some methods additionally accept a <code class="docutils literal notranslate"><span class="pre">dict</span></code> or <code class="docutils literal notranslate"><span class="pre">MapCoord</span></code> argument, of which both allow to assign coordinates by axis name.</p>
<p>Let us first begin with the <code class="docutils literal notranslate"><span class="pre">.get_by_idx()</span></code> method, that accepts a tuple of indices. The order of the indices corresponds to the axis order of the map:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_idx</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p><strong>Important:</strong> Gammapy uses a reversed index order in the map API with the longitude axes first. To achieve the same by directly indexing into the numpy array we have to call:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_gc</span><span class="o">.</span><span class="n">data</span><span class="p">[([</span><span class="mi">30</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">])]</span>
</pre></div>
</div>
</div>
<p>To check the order of the axes you can always print the <code class="docutils literal notranslate"><span class="pre">.geom</span></code> attribute:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">m_gc</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To access values directly by sky coordinates we can use the <code class="docutils literal notranslate"><span class="pre">.get_by_coord()</span></code> method. This time we pass in a <code class="docutils literal notranslate"><span class="pre">dict</span></code>, specifying the axes names corresponding to the given coordinates:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]})</span>
</pre></div>
</div>
</div>
<p>The units of the coordinates are assumed to be in degrees in the coordinate system used by the map. If the coordinates do not correspond to the exact pixel center, the value of the nearest pixel center will be returned. For positions outside the map geometry <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> is returned.</p>
<p>The coordinate or idx arrays follow normal <a class="reference external" href="https://jakevdp.github.io/PythonDataScienceHandbook/02.05-computation-on-arrays-broadcasting.html">Numpy broadcasting rules</a>. So the following works as expected:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="n">lons</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>Or as an even more advanced example, we can provide <code class="docutils literal notranslate"><span class="pre">lats</span></code> as column vector and broadcasting to a 2D result array will be applied:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">m_gc</span><span class="o">.</span><span class="n">get_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="n">lons</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">lats</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Indexing-and-Slicing-Sub-Maps">
<h3>Indexing and Slicing Sub-Maps<a class="headerlink" href="#Indexing-and-Slicing-Sub-Maps" title="Permalink to this headline">¶</a></h3>
<p>When you have worked with Numpy arrays in the past you are probably familiar with the concept of indexing and slicing into data arrays. To support slicing of non-spatial axes of <code class="docutils literal notranslate"><span class="pre">Map</span></code> objects, the <code class="docutils literal notranslate"><span class="pre">Map</span></code> object has a <code class="docutils literal notranslate"><span class="pre">.slice_by_idx()</span></code> method, which allows to extract sub-maps from a larger map.</p>
<p>The following example demonstrates how to get the map at the energy bin number 3:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_sub</span> <span class="o">=</span> <span class="n">m_cube</span><span class="o">.</span><span class="n">slice_by_idx</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_sub</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that the returned object is again a <code class="docutils literal notranslate"><span class="pre">Map</span></code> with updated axes information. In this case, because we extracted only a single image, the energy axes is dropped from the map.</p>
<p>To extract a sub-cube with a sliced energy axes we can use a normal <code class="docutils literal notranslate"><span class="pre">slice()</span></code> object:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_sub</span> <span class="o">=</span> <span class="n">m_cube</span><span class="o">.</span><span class="n">slice_by_idx</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_sub</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that the returned object is also a <code class="docutils literal notranslate"><span class="pre">Map</span></code> object, but this time with updated energy axis specification.</p>
<p>Slicing of multiple dimensions is supported by adding further entries to the dict passed to <code class="docutils literal notranslate"><span class="pre">.slice_by_idx()</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_sub</span> <span class="o">=</span> <span class="n">m_4d</span><span class="o">.</span><span class="n">slice_by_idx</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_sub</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For convenience there is also a <code class="docutils literal notranslate"><span class="pre">.get_image_by_coord()</span></code> method which allows to access image planes at given non-spatial physical coordinates. This method also supports <code class="docutils literal notranslate"><span class="pre">Quantity</span></code> objects:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">m_4d</span><span class="o">.</span><span class="n">get_image_by_coord</span><span class="p">({</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">h</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Iterating-by-image">
<h3>Iterating by image<a class="headerlink" href="#Iterating-by-image" title="Permalink to this headline">¶</a></h3>
<p>For maps with non-spatial dimensions the <code class="docutils literal notranslate"><span class="pre">~Map.iter_by_image</span></code> method can be used to loop over image slices. The image plane index <code class="docutils literal notranslate"><span class="pre">idx</span></code> is returned in data order, so that the data array can be indexed directly. Here is an example for an in-place convolution of an image using <code class="docutils literal notranslate"><span class="pre">astropy.convolution.convolve</span></code> to interpolate NaN values:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axis1</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">)</span>
<span class="n">axis2</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;lin&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">],</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">15</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span> <span class="mi">20</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="k">for</span> <span class="n">img</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">iter_by_image</span><span class="p">():</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>

<span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Modifying-Data">
<h2>Modifying Data<a class="headerlink" href="#Modifying-Data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="How-to-set-data-values">
<h3>How to set data values<a class="headerlink" href="#How-to-set-data-values" title="Permalink to this headline">¶</a></h3>
<p>To modify and set map data values the <code class="docutils literal notranslate"><span class="pre">Map</span></code> object features as well a <code class="docutils literal notranslate"><span class="pre">.set_by_idx()</span></code> method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">set_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">vals</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>here we check that data have been updated:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">get_by_idx</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Of course there is also a <code class="docutils literal notranslate"><span class="pre">.set_by_coord()</span></code> method, which allows to set map data values in physical coordinates.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_cube</span><span class="o">.</span><span class="n">set_by_coord</span><span class="p">({</span><span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">},</span> <span class="n">vals</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Again the <code class="docutils literal notranslate"><span class="pre">lon</span></code> and <code class="docutils literal notranslate"><span class="pre">lat</span></code> values are assumed to be given in degrees in the coordinate system used by the map. For the energy axis, the unit is the one specified on the axis (use <code class="docutils literal notranslate"><span class="pre">m_cube.geom.axes[0].unit</span></code> to check if needed…).</p>
<p>All <code class="docutils literal notranslate"><span class="pre">.xxx_by_coord()</span></code> methods accept <code class="docutils literal notranslate"><span class="pre">SkyCoord</span></code> objects as well. In this case we have to use the <code class="docutils literal notranslate"><span class="pre">skycoord</span></code> keyword instead of <code class="docutils literal notranslate"><span class="pre">lon</span></code> and <code class="docutils literal notranslate"><span class="pre">lat</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skycoords</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">m_cube</span><span class="o">.</span><span class="n">set_by_coord</span><span class="p">({</span><span class="s2">&quot;skycoord&quot;</span><span class="p">:</span> <span class="n">skycoords</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">},</span> <span class="n">vals</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Filling-maps-from-event-lists">
<h3>Filling maps from event lists<a class="headerlink" href="#Filling-maps-from-event-lists" title="Permalink to this headline">¶</a></h3>
<p>This example shows how to fill a counts cube from an event list:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
    <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GeV&quot;</span>
<span class="p">)</span>
<span class="n">counts_3d</span> <span class="o">=</span> <span class="n">WcsNDMap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">events</span> <span class="o">=</span> <span class="n">EventList</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-events.fits.gz&quot;</span>
<span class="p">)</span>

<span class="n">counts_3d</span><span class="o">.</span><span class="n">fill_by_coord</span><span class="p">({</span><span class="s2">&quot;skycoord&quot;</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">radec</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="n">events</span><span class="o">.</span><span class="n">energy</span><span class="p">})</span>
<span class="n">counts_3d</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ccube.fits&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;fgst-ccube&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Alternatively you can use the <code class="docutils literal notranslate"><span class="pre">fill_events</span></code> method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts_3d</span> <span class="o">=</span> <span class="n">WcsNDMap</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">counts_3d</span><span class="o">.</span><span class="n">fill_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If you have a given map already, and want to make a counts image with the same geometry (not using the pixel data from the original map), you can also use the <code class="docutils literal notranslate"><span class="pre">fill_events</span></code> method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events</span> <span class="o">=</span> <span class="n">EventList</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-events.fits.gz&quot;</span>
<span class="p">)</span>
<span class="n">reference_map</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-counts.fits.gz&quot;</span>
<span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_geom</span><span class="p">(</span><span class="n">reference_map</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
<span class="n">counts</span><span class="o">.</span><span class="n">fill_events</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>It works for IACT and Fermi-LAT events, for WCS or HEALPix map geometries, and also for extra axes. Especially energy axes are automatically handled correctly.</p>
</div>
<div class="section" id="Filling-maps-from-interpolation">
<h3>Filling maps from interpolation<a class="headerlink" href="#Filling-maps-from-interpolation" title="Permalink to this headline">¶</a></h3>
<p>Maps support interpolation via the <code class="docutils literal notranslate"><span class="pre">~Map.interp_by_coord</span></code> and <code class="docutils literal notranslate"><span class="pre">~Map.interp_by_pix</span></code> methods. Currently the following interpolation methods are supported:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nearest</span></code> : Return value of nearest pixel (no interpolation).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">linear</span></code> : Interpolation with first order polynomial. This is the only interpolation method that is supported for all map types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">quadratic</span></code> : Interpolation with second order polynomial.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cubic</span></code> : Interpolation with third order polynomial.</p></li>
</ul>
<p>Note that <code class="docutils literal notranslate"><span class="pre">quadratic</span></code> and <code class="docutils literal notranslate"><span class="pre">cubic</span></code> interpolation are currently only supported for WCS-based maps with regular geometry (e.g. 2D or ND with the same geometry in every image plane). <code class="docutils literal notranslate"><span class="pre">linear</span></code> and higher order interpolation by pixel coordinates is only supported for WCS-based maps.</p>
<p>In the following example we create a new map and fill it by interpolating another map:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read map</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/gll_iem_v06_gc.fits.gz&quot;</span>
<span class="n">m_iem_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># create new geometry</span>
<span class="n">skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">266.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.9</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">wcs_geom_cel</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">skydir</span><span class="o">=</span><span class="n">skydir</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># create new empty map from geometry</span>
<span class="n">m_iem_10GeV</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">from_geom</span><span class="p">(</span><span class="n">wcs_geom_cel</span><span class="p">)</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">()</span>

<span class="c1"># fill new map using interpolation</span>
<span class="n">m_iem_10GeV</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">m_iem_gc</span><span class="o">.</span><span class="n">interp_by_coord</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;skycoord&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="o">.</span><span class="n">skycoord</span><span class="p">,</span> <span class="s2">&quot;energy_true&quot;</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">GeV</span><span class="p">},</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Interpolating-onto-a-different-geometry">
<h3>Interpolating onto a different geometry<a class="headerlink" href="#Interpolating-onto-a-different-geometry" title="Permalink to this headline">¶</a></h3>
<p>For 3d geometries this operation can be performed directly using the <code class="docutils literal notranslate"><span class="pre">.interp_to_geom()</span></code> method. This is very useful, ex: while using map arithmetic.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create new geometry</span>
<span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_bounds</span><span class="p">(</span>
    <span class="mf">10.0</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_true&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;GeV&quot;</span>
<span class="p">)</span>
<span class="n">skydir</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mf">266.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">28.9</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">wcs_geom_3d</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">skydir</span><span class="o">=</span><span class="n">skydir</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;icrs&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># create the interpolated map</span>
<span class="n">m_iem_interp</span> <span class="o">=</span> <span class="n">m_iem_gc</span><span class="o">.</span><span class="n">interp_to_geom</span><span class="p">(</span>
    <span class="n">wcs_geom_3d</span><span class="p">,</span> <span class="n">preserve_counts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m_iem_interp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">preserve_counts</span></code> option should be true if the map is an integral quantity (e.g. counts) and false if the map is a differential quantity (e.g. intensity).</p>
</div>
</div>
<div class="section" id="Maps-operations">
<h2>Maps operations<a class="headerlink" href="#Maps-operations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Basic-operators">
<h3>Basic operators<a class="headerlink" href="#Basic-operators" title="Permalink to this headline">¶</a></h3>
<p>One can perform simple arithmetic on maps using the <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code> operators, this works only for maps with the same geometry:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iem_plus_iem</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span> <span class="o">+</span> <span class="n">m_iem_10GeV</span>

<span class="n">iem_minus_iem</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span> <span class="o">-</span> <span class="n">m_iem_10GeV</span>
</pre></div>
</div>
</div>
<p>These operations can be applied between a Map and a scalar in that specific order:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iem_times_two</span> <span class="o">=</span> <span class="n">m_iem_10GeV</span> <span class="o">*</span> <span class="mi">2</span>
<span class="c1"># iem_times_two = 2 * m_iem_10GeV # this won&#39;t work</span>
</pre></div>
</div>
</div>
<p>The logic operators can also by applied on maps (the result is a map of boolean type):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">is_null</span> <span class="o">=</span> <span class="n">iem_minus_iem</span> <span class="o">==</span> <span class="mi">0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">is_null</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Here we check that the result is <code class="docutils literal notranslate"><span class="pre">True</span></code> for all the well-defiend pixels (not <code class="docutils literal notranslate"><span class="pre">NaN</span></code>):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">is_null</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">iem_minus_iem</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Cutouts">
<h3>Cutouts<a class="headerlink" href="#Cutouts" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">WCSNDMap</span></code> objects features a <code class="docutils literal notranslate"><span class="pre">.cutout()</span></code> method, which allows you to cut out a smaller part of a larger map. This can be useful, e.g. when working with allsky diffuse maps. Here is an example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">position</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">m_iem_cutout</span> <span class="o">=</span> <span class="n">m_iem_gc</span><span class="o">.</span><span class="n">cutout</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The returned object is again a <code class="docutils literal notranslate"><span class="pre">Map</span></code> object with updated WCS information and data size. As one can see the cutout is automatically applied to all the non-spatial axes as well. The cutout width is given in the order of <code class="docutils literal notranslate"><span class="pre">(lon,</span> <span class="pre">lat)</span></code> and can be specified with units that will be handled correctly.</p>
</div>
</div>
<div class="section" id="Visualizing-and-Plotting">
<h2>Visualizing and Plotting<a class="headerlink" href="#Visualizing-and-Plotting" title="Permalink to this headline">¶</a></h2>
<p>All map objects provide a <code class="docutils literal notranslate"><span class="pre">plot</span></code> method for generating a visualization of a map. This method returns figure, axes, and image objects that can be used to further tweak/customize the image. The <code class="docutils literal notranslate"><span class="pre">plot</span></code> method should be used with 2D maps, while 3D maps can be displayed with the <code class="docutils literal notranslate"><span class="pre">.plot_interative()</span></code> or <code class="docutils literal notranslate"><span class="pre">.plot_grid()</span></code> methods.</p>
<div class="section" id="Image-Plotting">
<h3>Image Plotting<a class="headerlink" href="#Image-Plotting" title="Permalink to this headline">¶</a></h3>
<p>For debugging and inspecting the map data it is useful to plot or visualize the images planes contained in the map.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/fermi-3fhl-gc-counts.fits.gz&quot;</span>
<span class="n">m_3fhl_gc</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>After reading the map we can now plot it on the screen by calling the <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> method:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m_3fhl_gc</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<p>We can easily improve the plot by calling <code class="docutils literal notranslate"><span class="pre">Map.smooth()</span></code> first and providing additional arguments to <code class="docutils literal notranslate"><span class="pre">.plot()</span></code>. Most of them are passed further to <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.imshow.html">plt.imshow()</a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smoothed</span> <span class="o">=</span> <span class="n">m_3fhl_gc</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>We can use the <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.rc_context.html">plt.rc_context()</a> context manager to further tweak the plot by adapting the figure and font size:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rc_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">),</span> <span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">rc_context</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="n">rc_params</span><span class="p">):</span>
    <span class="n">smoothed</span> <span class="o">=</span> <span class="n">m_3fhl_gc</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
    <span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Cube-plotting">
<h3>Cube plotting<a class="headerlink" href="#Cube-plotting" title="Permalink to this headline">¶</a></h3>
<p>For maps with non-spatial dimensions the <code class="docutils literal notranslate"><span class="pre">Map</span></code> object features an interactive plotting method, that works in jupyter notebooks only (Note: it requires the package <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code> to be installed). We first read a small example cutout from the Fermi Galactic diffuse model and display the data cube by calling <code class="docutils literal notranslate"><span class="pre">.plot_interactive()</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rc_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">),</span>
    <span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s2">&quot;axes.formatter.limits&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>
<span class="p">}</span>
<span class="n">m_iem_gc</span><span class="o">.</span><span class="n">plot_interactive</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;sqrt&quot;</span><span class="p">,</span> <span class="n">rc_params</span><span class="o">=</span><span class="n">rc_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now you can use the interactive slider to select an energy range and the corresponding image is displayed on the screen. You can also use the radio buttons to select your preferred image stretching. We have passed additional keywords using the <code class="docutils literal notranslate"><span class="pre">rc_params</span></code> argument to improve the figure and font size. Those keywords are directly passed to the <a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.rc_context.html">plt.rc_context()</a> context manager.</p>
<p>Additionally all the slices of a 3D <code class="docutils literal notranslate"><span class="pre">Map</span></code> can be displayed using the <code class="docutils literal notranslate"><span class="pre">.plot_grid()</span></code> method. By default the colorbars bounds of the subplots are not the same, we can make them consistent using the <code class="docutils literal notranslate"><span class="pre">vmin</span></code> and <code class="docutils literal notranslate"><span class="pre">vmax</span></code> options:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">counts_3d</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {"165bbe3c053b44fc9747fb9f234c2417": {"model_module": "@jupyter-widgets/output", "model_module_version": "1.0.0", "model_name": "OutputModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/output", "_model_module_version": "1.0.0", "_model_name": "OutputModel", "_view_count": null, "_view_module": "@jupyter-widgets/output", "_view_module_version": "1.0.0", "_view_name": "OutputView", "layout": "IPY_MODEL_8772c8d1f8384b958f91805191d50235", "msg_id": "", "outputs": []}}, "67f9b51530bf4e12bddf6d82aeb8b8f0": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": "initial"}}, "7b5cae29cd0440e0978d862d8e7d7021": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": "initial"}}, "8772c8d1f8384b958f91805191d50235": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "8c0504fb9e774d88aab5a9aa1f7daaaa": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": "50%"}}, "959aeaca9c8b48a094873145ffef10c6": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "97ca79ad83204a98968f69b36729e301": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "RadioButtonsModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "RadioButtonsModel", "_options_labels": ["linear", "sqrt", "log"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "RadioButtonsView", "description": "Select stretch:", "description_tooltip": null, "disabled": false, "index": 1, "layout": "IPY_MODEL_a4ffa90d854d40039b22aa4dcf407cd8", "style": "IPY_MODEL_67f9b51530bf4e12bddf6d82aeb8b8f0"}}, "a4ffa90d854d40039b22aa4dcf407cd8": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d0376e517c494199814d81953eb3f95c": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "SelectionSliderModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "SelectionSliderModel", "_options_labels": ["5.85e+01 MeV MeV", "8.00e+01 MeV MeV", "1.09e+02 MeV MeV", "1.50e+02 MeV MeV", "2.05e+02 MeV MeV", "2.80e+02 MeV MeV", "3.83e+02 MeV MeV", "5.23e+02 MeV MeV", "7.16e+02 MeV MeV", "9.79e+02 MeV MeV", "1.34e+03 MeV MeV", "1.83e+03 MeV MeV", "2.50e+03 MeV MeV", "3.42e+03 MeV MeV", "4.68e+03 MeV MeV", "6.41e+03 MeV MeV", "8.76e+03 MeV MeV", "1.20e+04 MeV MeV", "1.64e+04 MeV MeV", "2.24e+04 MeV MeV", "3.06e+04 MeV MeV", "4.19e+04 MeV MeV", "5.73e+04 MeV MeV", "7.84e+04 MeV MeV", "1.07e+05 MeV MeV", "1.47e+05 MeV MeV", "2.01e+05 MeV MeV", "2.74e+05 MeV MeV", "3.75e+05 MeV MeV", "5.13e+05 MeV MeV"], "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "SelectionSliderView", "continuous_update": false, "description": "Select energy_true:", "description_tooltip": null, "disabled": false, "index": 0, "layout": "IPY_MODEL_8c0504fb9e774d88aab5a9aa1f7daaaa", "orientation": "horizontal", "readout": true, "style": "IPY_MODEL_7b5cae29cd0440e0978d862d8e7d7021"}}, "fcb67bef27fd4f3f89975aa73d805b39": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "VBoxModel", "state": {"_dom_classes": ["widget-interact"], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "VBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "VBoxView", "box_style": "", "children": ["IPY_MODEL_d0376e517c494199814d81953eb3f95c", "IPY_MODEL_97ca79ad83204a98968f69b36729e301", "IPY_MODEL_165bbe3c053b44fc9747fb9f234c2417"], "layout": "IPY_MODEL_959aeaca9c8b48a094873145ffef10c6"}}}, "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../analysis/1D/sed_fitting.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Flux point fitting</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../maps/hpxmap.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">HEALPix-based maps</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>