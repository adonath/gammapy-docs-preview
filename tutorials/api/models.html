
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Models &#8212; gammapy v0.20.dev703+gba08bf709</title>
    
    <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gammapy.css" />
    
    <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/gammapy_logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Fitting" href="fitting.html" />
    <link rel="prev" title="Modeling and Fitting (DL4 to DL5)" href="../../userguide/modeling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/gammapy_logo_nav.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../getting-started/index.html">
  Getting started
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../userguide/index.html">
  User guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../development/index.html">
  Development
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../changelog/index.html">
  Release notes
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <div class="dropdown" id="version_switcher">
    <button type="button" class="btn btn-primary btn-sm navbar-btn dropdown-toggle" id="version_switcher_button" data-toggle="dropdown">
        dev  <!-- this text may get changed later by javascript -->
        <span class="caret"></span>
    </button>
    <div id="version_switcher_menu" class="dropdown-menu list-group-flush py-0" aria-labelledby="version_switcher_button">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
</div>

<!-- NOTE: this JS must live here (not in our global JS file) because it relies
     on being processed by Jinja before it is run (specifically for replacing
     variables tutorials/api/models and {'json_url': 'https://docs.gammapy.org/stable/switcher.json', 'url_template': 'https://docs.gammapy.org/{version}/', 'version_match': 'dev'}.
-->

<script type="text/javascript">
// Construct the target URL from the JSON components
function buildURL(entry) {
    var template = "https://docs.gammapy.org/{version}/";  // supplied by jinja
    template = template.replace("{version}", entry.version);
    return template;
}

// Check if corresponding page path exists in other version of docs
// and, if so, go there instead of the homepage of the other docs version
function checkPageExistsAndRedirect(event) {
    const currentFilePath = "tutorials/api/models.html",
          tryUrl = event.target.getAttribute("href");
    let otherDocsHomepage = tryUrl.replace(currentFilePath, "");
    $.ajax({
        type: 'HEAD',
        url: tryUrl,
        // if the page exists, go there
        success: function() {
            location.href = tryUrl;
        }
    }).fail(function() {
        location.href = otherDocsHomepage;
    });
    // this prevents the browser from following the href of the clicked node
    // (which is fine because this function takes care of redirecting)
    return false;
}

// Populate the version switcher from the JSON config file
(function () {
    $.getJSON("https://docs.gammapy.org/stable/switcher.json", function(data, textStatus, jqXHR) {
        const currentFilePath = "tutorials/api/models.html";
        // create links to the corresponding page in the other docs versions
        $.each(data, function(index, entry) {
            // if no custom name specified (e.g., "latest"), use version string
            if (!("name" in entry)) {
                entry.name = entry.version;
            }
            // create the node
            const node = document.createElement("a");
            node.setAttribute("class", "list-group-item list-group-item-action py-1");
            node.textContent = `${entry.name}`;
            // get the base URL for that doc version, add the current page's
            // path to it, and set as `href`
            entry.url = buildURL(entry);
            node.setAttribute("href", `${entry.url}${currentFilePath}`);
            // on click, AJAX calls will check if the linked page exists before
            // trying to redirect, and if not, will redirect to the homepage
            // for that version of the docs.
            node.onclick = checkPageExistsAndRedirect;
            $("#version_switcher_menu").append(node);
            // replace dropdown button text with the preferred display name of
            // this version, rather than using sphinx's 0.20.dev703+gba08bf709 variable.
            // also highlight the dropdown entry for the currently-viewed
            // version's entry
            if (entry.version == "dev") {
                node.classList.add("active");
                $("#version_switcher_button").text(entry.name);
            }
        });
    });
})();
</script>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/gammapy/gammapy" rel="noopener" target="_blank" title="Github"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">Github</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/gammapyST" rel="noopener" target="_blank" title="Twitter"><span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://gammapy.slack.com/" rel="noopener" target="_blank" title="Slack"><span><i class="fab fa-slack"></i></span>
            <label class="sr-only">Slack</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../userguide/analysis.html">
   Gamma-ray data analysis
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../userguide/package.html">
   Package structure
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/dl3.html">
     Data access and selection (DL3)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/makers.html">
     Data reduction (DL3 to DL4)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/dl4.html">
     Datasets (DL4)
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="reference internal" href="../../userguide/modeling.html">
     Modeling and Fitting (DL4 to DL5)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/hli.html">
     High Level Analysis Interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/catalog.html">
     Source catalogs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/astro.html">
     Astrophysics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/stats.html">
     Statistical utility functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/cli.html">
     Command line tools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/visualization.html">
     Plotting features
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../userguide/utils.html">
     Utility functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Tutorials
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../starting/analysis_1.html">
     High level interface
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../starting/analysis_2.html">
     Low level API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../starting/overview.html">
     Data structures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/cta.html">
     CTA with Gammapy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/hess.html">
     H.E.S.S. with Gammapy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/fermi_lat.html">
     Fermi-LAT with Gammapy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/spectral_analysis.html">
     Spectral analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/spectral_analysis_rad_max.html">
     Spectral analysis with energy-dependent directional cuts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/sed_fitting.html">
     Flux point fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/extended_source_spectral_analysis.html">
     Spectral analysis of extended sources
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/spectrum_simulation.html">
     1D spectrum simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/1D/cta_sensitivity.html">
     Point source sensitivity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/2D/ring_background.html">
     Ring background map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/2D/modeling_2D.html">
     2D map fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/2D/detect.html">
     Source detection and significance maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/cta_data_analysis.html">
     Basic image exploration and fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/analysis_3d.html">
     3D detailed analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/simulate_3d.html">
     3D map simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/analysis_mwl.html">
     Multi instrument joint 3D and 1D analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/event_sampling.html">
     Event sampling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/3D/flux_profiles.html">
     Flux Profile Estimation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/light_curve_simulation.html">
     Simulating and fitting a time varying source
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/light_curve.html">
     Light curves
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/light_curve_flare.html">
     Light curves for flares
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../analysis/time/pulsar_analysis.html">
     Pulsar analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="makers.html">
     Makers - Data reduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="catalog.html">
     Source catalogs
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="model_management.html">
     Modelling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fitting.html">
     Fitting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="maps.html">
     Maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mask_maps.html">
     Mask maps
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="astro_dark_matter.html">
     Dark matter spatial and spectral models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="datasets.html">
     Datasets - Reduced data, IRFs, models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../survey_map.html">
     Survey map
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../userguide/howto.html">
   How To
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../modeling/gallery/index.html">
   Model gallery
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_constant.html">
     Constant spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_disk.html">
     Disk spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_gauss.html">
     Gaussian spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_gen_gauss.html">
     Generalized gaussian spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_point.html">
     Point spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_shell.html">
     Shell spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_shell2.html">
     Shell2 spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spatial/plot_template.html">
     Template spatial model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_absorbed.html">
     EBL absorbption spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_broken_powerlaw.html">
     Broken power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_compound.html">
     Compound spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_constant_spectral.html">
     Constant spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_exp_cutoff_powerlaw.html">
     Exponential cutoff power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_exp_cutoff_powerlaw_3fgl.html">
     Exponential cutoff power law spectral model used for 3FGL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_gauss_spectral.html">
     Gaussian spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_logparabola.html">
     Log parabola spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_naima.html">
     Naima spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_piecewise_norm_spectral.html">
     Piecewise  norm spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_powerlaw.html">
     Power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_powerlaw2.html">
     Power law 2 spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_smooth_broken_powerlaw.html">
     Smooth broken power law spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_super_exp_cutoff_powerlaw_3fgl.html">
     Super exponential cutoff power law model used for 3FGL
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_super_exp_cutoff_powerlaw_4fgl.html">
     Super Exponential Cutoff Power Law Model used for 4FGL-DR3
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_super_exp_cutoff_powerlaw_4fgl_dr1.html">
     Super Exponential Cutoff Power Law Model used for 4FGL-DR1 (and DR2)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/spectral/plot_template_spectral.html">
     Template spectral model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_constant_temporal.html">
     Constant temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_expdecay_temporal.html">
     ExpDecay temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_gaussian_temporal.html">
     Gaussian temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_generalized_gaussian_temporal.html">
     Generalized Gaussian temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_linear_temporal.html">
     Linear temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_powerlaw_temporal.html">
     PowerLaw temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_sine_temporal.html">
     Sine temporal model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../modeling/gallery/temporal/plot_template_temporal.html">
     Light curve temporal model
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://gammapy.github.io/gammapy-recipes">
   Gammapy recipes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../userguide/references.html">
   Glossary and references
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Spectral-models">
   Spectral models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Norm-Spectral-Models">
     Norm Spectral Models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Compound-Spectral-Model">
     Compound Spectral Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Spatial-models">
   Spatial models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Temporal-models">
   Temporal models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#SkyModel">
   SkyModel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Modifying-model-parameters">
   Modifying model parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Model-lists-and-serialisation">
   Model lists and serialisation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Models-with-shared-parameter">
   Models with shared parameter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Implementing-a-custom-model">
   Implementing a custom model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Models-with-energy-dependent-morphology">
   Models with energy dependent morphology
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Models">
<h1>Models<a class="headerlink" href="#Models" title="Permalink to this headline">¶</a></h1>
<p>This is an introduction and overview on how to work with models in Gammapy.</p>
<p>The sub-package <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling</span></code> contains all the functionality related to modeling and fitting data. This includes spectral, spatial and temporal model classes, as well as the fit and parameter API. We will cover the following topics in order:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Spectral-Models">Spectral Models</a></p></li>
<li><p><a class="reference external" href="#Spatial-Models">Spatial Models</a></p></li>
<li><p><a class="reference external" href="#Temporal-Models">Temporal Models</a></p></li>
<li><p><a class="reference external" href="#SkyModel">SkyModel</a></p></li>
<li><p><a class="reference external" href="#Modifying-model-parameters">Modifying model parameters</a></p></li>
<li><p><a class="reference external" href="#Model-Lists-and-Serialisation">Model Lists and Serialisation</a></p></li>
<li><p><a class="reference external" href="#Models-with-shared-parameter">Models with shared parameter</a></p></li>
<li><p><a class="reference external" href="#Implementing-a-Custom-Model">Implementing as Custom Model</a></p></li>
<li><p><a class="reference external" href="#Models-with-energy-dependent-morphology">Energy dependent models</a></p></li>
</ol>
<p>The models follow a naming scheme which contains the category as a suffix to the class name. An overview of all the available models can be found in the <a class="reference internal" href="../../modeling/gallery/index.html#spectral-models"><span class="std std-ref">model gallery</span></a>.</p>
<p>Note that there are separate tutorials, <a class="reference internal" href="model_management.html"><span class="doc">model_management</span></a> and <a class="reference internal" href="fitting.html"><span class="doc">fitting</span></a> that explains about <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling</span></code>, the Gammapy modeling and fitting framework. You have to read that to learn how to work with models in order to analyse data.</p>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">gammapy.maps</span> <span class="kn">import</span> <span class="n">Map</span><span class="p">,</span> <span class="n">WcsGeom</span><span class="p">,</span> <span class="n">MapAxis</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Spectral-models">
<h2>Spectral models<a class="headerlink" href="#Spectral-models" title="Permalink to this headline">¶</a></h2>
<p>All models are imported from the <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling.models</span></code> namespace. Let’s start with a <code class="docutils literal notranslate"><span class="pre">PowerLawSpectralModel</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">PowerLawSpectralModel</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pwl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To get a list of all available spectral models you can import and print the spectral model registry or take a look at the <a class="reference external" href="https://docs.gammapy.org/dev/modeling/gallery/index.html#spectral-models">model gallery</a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SPECTRAL_MODEL_REGISTRY</span>

<span class="nb">print</span><span class="p">(</span><span class="n">SPECTRAL_MODEL_REGISTRY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Spectral models all come with default parameters. Different parameter values can be passed on creation of the model, either as a string defining the value and unit or as an <code class="docutils literal notranslate"><span class="pre">astropy.units.Quantity</span></code> object directly:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">amplitude</span> <span class="o">=</span> <span class="mf">1e-12</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;TeV-1 cm-2 s-1&quot;</span><span class="p">)</span>
<span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For convenience a <code class="docutils literal notranslate"><span class="pre">str</span></code> specifying the value and unit can be passed as well:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="s2">&quot;2.7e-12 TeV-1 cm-2 s-1&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mf">2.2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pwl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The model can be evaluated at given energies by calling the model instance:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">dnde</span> <span class="o">=</span> <span class="n">pwl</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dnde</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The returned quantity is a differential photon flux.</p>
<p>For spectral models you can additionally compute the integrated and energy flux in a given energy range:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flux</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">energy_min</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>

<span class="n">eflux</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">energy_flux</span><span class="p">(</span><span class="n">energy_min</span><span class="o">=</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">eflux</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This also works for a list or an array of integration boundaries:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">energy_min</span><span class="o">=</span><span class="n">energy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">energy_max</span><span class="o">=</span><span class="n">energy</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In some cases it can be useful to find use the inverse of a spectral model, to find the energy at which a given flux is reached:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dnde</span> <span class="o">=</span> <span class="mf">2.7e-12</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;TeV-1 cm-2 s-1&quot;</span><span class="p">)</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">dnde</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As a convenience you can also plot any spectral model in a given energy range:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pwl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Norm-Spectral-Models">
<h3>Norm Spectral Models<a class="headerlink" href="#Norm-Spectral-Models" title="Permalink to this headline">¶</a></h3>
<p>Normed spectral models are a special class of Spectral Models, which have a dimension-less normalisation. These spectral models feature a norm parameter instead of amplitude and are named using the <code class="docutils literal notranslate"><span class="pre">NormSpectralModel</span></code> suffix. They <strong>must</strong> be used along with another spectral model, as a multiplicative correction factor according to their spectral shape. They can be typically used for adjusting template based models, or adding a EBL correction to some analytic model.</p>
<p>To check if a given <code class="docutils literal notranslate"><span class="pre">SpectralModel</span></code> is a norm model, you can simply look at the <code class="docutils literal notranslate"><span class="pre">is_norm_spectral_model</span></code> property</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To see the available norm models shipped with gammapy:</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">SPECTRAL_MODEL_REGISTRY</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">is_norm_spectral_model</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As an example, we see the <code class="docutils literal notranslate"><span class="pre">PowerLawNormSpectralModel</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">PowerLawNormSpectralModel</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pwl_norm</span> <span class="o">=</span> <span class="n">PowerLawNormSpectralModel</span><span class="p">(</span><span class="n">tilt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pwl_norm</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can check the correction introduced at each energy</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">pwl_norm</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>A typical use case of a norm model would be in applying spectral correction to a <code class="docutils literal notranslate"><span class="pre">TemplateSpectralModel</span></code>. A template model is defined by custom tabular values provided at initialization.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">TemplateSpectralModel</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="s2">&quot;TeV-1 s-1 cm-2&quot;</span><span class="p">)</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">TemplateSpectralModel</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
<span class="n">template</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_bounds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;template model&quot;</span><span class="p">)</span>
<span class="n">normed_template</span> <span class="o">=</span> <span class="n">template</span> <span class="o">*</span> <span class="n">pwl_norm</span>
<span class="n">normed_template</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">energy_bounds</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;normed_template model&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Compound-Spectral-Model">
<h3>Compound Spectral Model<a class="headerlink" href="#Compound-Spectral-Model" title="Permalink to this headline">¶</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">CompoundSpectralModel</span></code> is an arithmetic combination of two spectral models. The model <code class="docutils literal notranslate"><span class="pre">normed_template</span></code> created in the preceding example is an example of a <code class="docutils literal notranslate"><span class="pre">CompoundSpectralModel</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">normed_template</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To create an additive model, you can do simply:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_add</span> <span class="o">=</span> <span class="n">pwl</span> <span class="o">+</span> <span class="n">template</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_add</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Spatial-models">
<h2>Spatial models<a class="headerlink" href="#Spatial-models" title="Permalink to this headline">¶</a></h2>
<p>Spatial models are imported from the same <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling.models</span></code> namespace, let’s start with a <code class="docutils literal notranslate"><span class="pre">GaussianSpatialModel</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">GaussianSpatialModel</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gauss</span> <span class="o">=</span> <span class="n">GaussianSpatialModel</span><span class="p">(</span><span class="n">lon_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;0.2 deg&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gauss</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Again you can check the <code class="docutils literal notranslate"><span class="pre">SPATIAL_MODELS</span></code> registry to see which models are available or take a look at the <a class="reference external" href="https://docs.gammapy.org/dev/modeling/gallery/index.html#spatial-models">model gallery</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SPATIAL_MODEL_REGISTRY</span>

<span class="nb">print</span><span class="p">(</span><span class="n">SPATIAL_MODEL_REGISTRY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The default coordinate frame for all spatial models is <code class="docutils literal notranslate"><span class="pre">&quot;icrs&quot;</span></code>, but the frame can be modified using the <code class="docutils literal notranslate"><span class="pre">frame</span></code> argument:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gauss</span> <span class="o">=</span> <span class="n">GaussianSpatialModel</span><span class="p">(</span>
    <span class="n">lon_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;0.2 deg&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can specify any valid <code class="docutils literal notranslate"><span class="pre">astropy.coordinates</span></code> frame. The center position of the model can be retrieved as a <code class="docutils literal notranslate"><span class="pre">astropy.coordinates.SkyCoord</span></code> object using <code class="docutils literal notranslate"><span class="pre">SpatialModel.position</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gauss</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Spatial models can be evaluated again by calling the instance:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lon</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">lat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>

<span class="n">flux_per_omega</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">flux_per_omega</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The returned quantity corresponds to a surface brightness. Spatial model can be also evaluated using <code class="docutils literal notranslate"><span class="pre">~gammapy.maps.Map</span></code> and <code class="docutils literal notranslate"><span class="pre">~gammapy.maps.Geom</span></code> objects:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">Map</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">gauss</span><span class="o">.</span><span class="n">evaluate_geom</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Again for convenience the model can be plotted directly:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gauss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>All spatial models have an associated sky region to it e.g. to illustrate the extend of the model on a sky image. The returned object is an <code class="docutils literal notranslate"><span class="pre">regions.SkyRegion</span></code> object:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gauss</span><span class="o">.</span><span class="n">to_region</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>Now we can plot the region on an sky image:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create and plot the model</span>
<span class="n">gauss_elongated</span> <span class="o">=</span> <span class="n">GaussianSpatialModel</span><span class="p">(</span>
    <span class="n">lon_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="s2">&quot;0.2 deg&quot;</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">phi</span><span class="o">=</span><span class="s2">&quot;45 deg&quot;</span>
<span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">gauss_elongated</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># add region illustration</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">gauss_elongated</span><span class="o">.</span><span class="n">to_region</span><span class="p">()</span>
<span class="n">region_pix</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">to_pixel</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">wcs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">region_pix</span><span class="o">.</span><span class="n">as_artist</span><span class="p">(</span><span class="n">ec</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.to_region()</span></code> method can also be useful to write e.g. ds9 region files using <code class="docutils literal notranslate"><span class="pre">write_ds9</span></code> from the <code class="docutils literal notranslate"><span class="pre">regions</span></code> package:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">regions</span> <span class="kn">import</span> <span class="n">write_ds9</span>

<span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">gauss</span><span class="o">.</span><span class="n">to_region</span><span class="p">(),</span> <span class="n">gauss_elongated</span><span class="o">.</span><span class="n">to_region</span><span class="p">()]</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;regions.reg&quot;</span>
<span class="n">write_ds9</span><span class="p">(</span>
    <span class="n">regions</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">coordsys</span><span class="o">=</span><span class="s2">&quot;galactic&quot;</span><span class="p">,</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.4f&quot;</span><span class="p">,</span>
    <span class="n">radunit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat regions.reg
</pre></div>
</div>
</div>
</div>
<div class="section" id="Temporal-models">
<h2>Temporal models<a class="headerlink" href="#Temporal-models" title="Permalink to this headline">¶</a></h2>
<p>Temporal models are imported from the same <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling.models</span></code> namespace, let’s start with a <code class="docutils literal notranslate"><span class="pre">GaussianTemporalModel</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">GaussianTemporalModel</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gauss_temp</span> <span class="o">=</span> <span class="n">GaussianTemporalModel</span><span class="p">(</span><span class="n">t_ref</span><span class="o">=</span><span class="mf">59240.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gauss_temp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To check the <code class="docutils literal notranslate"><span class="pre">TEMPORAL_MODELS</span></code> registry to see which models are available:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">TEMPORAL_MODEL_REGISTRY</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TEMPORAL_MODEL_REGISTRY</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Temporal models can be evaluated on <code class="docutils literal notranslate"><span class="pre">astropy.time.Time</span></code> objects. The returned quantity is a dimensionless number</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.time</span> <span class="kn">import</span> <span class="n">Time</span>

<span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="s2">&quot;2021-01-29 00:00:00.000&quot;</span><span class="p">)</span>
<span class="n">gauss_temp</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As for other models, they can be plotted in a given time range</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">([</span><span class="mf">59233.0</span><span class="p">,</span> <span class="mi">59250</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;mjd&quot;</span><span class="p">)</span>
<span class="n">gauss_temp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="SkyModel">
<h2>SkyModel<a class="headerlink" href="#SkyModel" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling.models.SkyModel</span></code> class combines a spectral, and optionally, a spatial model and a temporal. It can be created from existing spectral, spatial and temporal model components:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SkyModel</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span>
    <span class="n">spectral_model</span><span class="o">=</span><span class="n">pwl</span><span class="p">,</span>
    <span class="n">spatial_model</span><span class="o">=</span><span class="n">gauss</span><span class="p">,</span>
    <span class="n">temporal_model</span><span class="o">=</span><span class="n">gauss_temp</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-source&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>It is good practice to specify a name for your sky model, so that you can access it later by name and have meaningful identifier you serilisation. If you don’t define a name, a unique random name is generated:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_without_name</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">pwl</span><span class="p">,</span> <span class="n">spatial_model</span><span class="o">=</span><span class="n">gauss</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_without_name</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The individual components of the source model can be accessed using <code class="docutils literal notranslate"><span class="pre">.spectral_model</span></code>, <code class="docutils literal notranslate"><span class="pre">.spatial_model</span></code> and <code class="docutils literal notranslate"><span class="pre">.temporal_model</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">spatial_model</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">temporal_model</span>
</pre></div>
</div>
</div>
<p>And can be used as you have seen already seen above:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Note that the gammapy fitting can interface only with a <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> and <strong>not</strong> its individual components. So, it is customary to work with <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> even if you are not doing a 3D fit. Since the amplitude parameter resides on the <code class="docutils literal notranslate"><span class="pre">SpectralModel</span></code>, specifying a spectral component is compulsory. The temporal and spatial components are optional. The temporal model needs to be specified only for timing analysis. In some cases (e.g. when doing a spectral analysis) there is no need for a spatial
component either, and only a spectral model is associated with the source.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_spectrum</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">pwl</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source-spectrum&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_spectrum</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Additionally the spatial model of <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling.models.SkyModel</span></code> can be used to represent source models based on templates, where the spatial and energy axes are correlated. It can be created e.g. from an existing FITS file:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">TemplateSpatialModel</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">PowerLawNormSpectralModel</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffuse_cube</span> <span class="o">=</span> <span class="n">TemplateSpatialModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;$GAMMAPY_DATA/fermi-3fhl-gc/gll_iem_v06_gc.fits.gz&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">diffuse</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">PowerLawNormSpectralModel</span><span class="p">(),</span> <span class="n">diffuse_cube</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">diffuse</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that if the spatial model is not normalized over the sky it has to be combined with a normalized spectral model, for example <code class="docutils literal notranslate"><span class="pre">~gammapy.modeling.models.PowerLawNormSpectralModel</span></code>. This is the only case in <code class="docutils literal notranslate"><span class="pre">gammapy.models.SkyModel</span></code> where the unit is fully attached to the spatial model.</p>
</div>
<div class="section" id="Modifying-model-parameters">
<h2>Modifying model parameters<a class="headerlink" href="#Modifying-model-parameters" title="Permalink to this headline">¶</a></h2>
<p>Model parameters can be modified (eg: frozen, values changed, etc at any point), eg:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Freezing a parameter</span>
<span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Making a parameter free</span>
<span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">frozen</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Changing a value</span>
<span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting min and max ranges on parameters</span>
<span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">model</span><span class="o">.</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="mf">5.0</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualise the model as a table</span>
<span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">to_table</span><span class="p">()</span><span class="o">.</span><span class="n">show_in_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>You can use the interactive boxes to choose model parameters by name, type or other attrributes mentioned in the column names.</p>
</div>
<div class="section" id="Model-lists-and-serialisation">
<h2>Model lists and serialisation<a class="headerlink" href="#Model-lists-and-serialisation" title="Permalink to this headline">¶</a></h2>
<p>In a typical analysis scenario a model consists of multiple model components, or a “catalog” or “source library”. To handle this list of multiple model components, Gammapy has a <code class="docutils literal notranslate"><span class="pre">Models</span></code> class:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">Models</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">([</span><span class="n">model</span><span class="p">,</span> <span class="n">diffuse</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Individual model components in the list can be accessed by their name:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="p">[</span><span class="s2">&quot;my-source&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p><strong>Note:</strong>To make the access by name unambiguous, models are required to have a unique name, otherwise an error will be thrown.</p>
<p>To see which models are available you can use the <code class="docutils literal notranslate"><span class="pre">.names</span></code> attribute:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that a <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> object can be evaluated for a given longitude, latitude, and energy, but the <code class="docutils literal notranslate"><span class="pre">Models</span></code> object cannot. This <code class="docutils literal notranslate"><span class="pre">Models</span></code> container object will be assigned to <code class="docutils literal notranslate"><span class="pre">Dataset</span></code> or <code class="docutils literal notranslate"><span class="pre">Datasets</span></code> together with the data to be fitted as explained in other analysis tutorials (see for example the <a class="reference internal" href="../analysis/2D/modeling_2D.html"><span class="doc">modeling</span></a> notebook).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Models</span></code> class also has in place <code class="docutils literal notranslate"><span class="pre">.append()</span></code> and <code class="docutils literal notranslate"><span class="pre">.extend()</span></code> methods:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_copy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-source-copy&quot;</span><span class="p">)</span>
<span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_copy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>This list of models can be also serialised to a custom YAML based format:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_yaml</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">models_yaml</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The structure of the yaml files follows the structure of the python objects. The <code class="docutils literal notranslate"><span class="pre">components</span></code> listed correspond to the <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> and <code class="docutils literal notranslate"><span class="pre">SkyDiffuseCube</span></code> components of the <code class="docutils literal notranslate"><span class="pre">Models</span></code>. For each <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> we have information about its <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> (corresponding to the tag attribute) and sub-mobels (i.e <code class="docutils literal notranslate"><span class="pre">spectral</span></code> model and eventually <code class="docutils literal notranslate"><span class="pre">spatial</span></code> model). Then the spatial and spectral models are defined by their type and parameters. The <code class="docutils literal notranslate"><span class="pre">parameters</span></code> keys name/value/unit are
mandatory, while the keys min/max/frozen are optionnals (so you can prepare shorter files).</p>
<p>If you want to write this list of models to disk and read it back later you can use:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;models.yaml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_read</span> <span class="o">=</span> <span class="n">Models</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;models.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Additionally the models can exported and imported togeter with the data using the <code class="docutils literal notranslate"><span class="pre">Datasets.read()</span></code> and <code class="docutils literal notranslate"><span class="pre">Datasets.write()</span></code> methods as shown in the <a class="reference internal" href="../analysis/3D/analysis_mwl.html"><span class="doc">analysis_mwl</span></a> notebook.</p>
</div>
<div class="section" id="Models-with-shared-parameter">
<h2>Models with shared parameter<a class="headerlink" href="#Models-with-shared-parameter" title="Permalink to this headline">¶</a></h2>
<p>A model parameter can be shared with other models, for example we can define two power-law models with the same spectral index but different amplitudes:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pwl2</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">()</span>
<span class="n">pwl2</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pwl</span><span class="o">.</span><span class="n">index</span>
<span class="n">pwl</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">2.3</span>  <span class="c1"># also update pwl2 as the parameter object is now the same as shown below</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pwl</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pwl2</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In the YAML files the shared parameter is flagged by the additional <code class="docutils literal notranslate"><span class="pre">link</span></code> entry that follows the convention <code class="docutils literal notranslate"><span class="pre">parameter.name&#64;unique_id</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">(</span>
    <span class="p">[</span><span class="n">SkyModel</span><span class="p">(</span><span class="n">pwl</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source1&quot;</span><span class="p">),</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">pwl2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;source2&quot;</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">models_yaml</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">models_yaml</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Implementing-a-custom-model">
<h2>Implementing a custom model<a class="headerlink" href="#Implementing-a-custom-model" title="Permalink to this headline">¶</a></h2>
<p>In order to add a user defined spectral model you have to create a SpectralModel subclass. This new model class should include:</p>
<ul class="simple">
<li><p>a tag used for serialization (it can be the same as the class name)</p></li>
<li><p>an instantiation of each Parameter with their unit, default values and frozen status</p></li>
<li><p>the evaluate function where the mathematical expression for the model is defined.</p></li>
</ul>
<p>As an example we will use a PowerLawSpectralModel plus a Gaussian (with fixed width). First we define the new custom model class that we name <code class="docutils literal notranslate"><span class="pre">MyCustomSpectralModel</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling</span> <span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SpectralModel</span>


<span class="k">class</span> <span class="nc">MyCustomSpectralModel</span><span class="p">(</span><span class="n">SpectralModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;My custom spectral model, parametrising a power law plus a Gaussian spectral line.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    amplitude : `astropy.units.Quantity`</span>
<span class="sd">        Amplitude of the spectra model.</span>
<span class="sd">    index : `astropy.units.Quantity`</span>
<span class="sd">        Spectral index of the model.</span>
<span class="sd">    reference : `astropy.units.Quantity`</span>
<span class="sd">        Reference energy of the power law.</span>
<span class="sd">    mean : `astropy.units.Quantity`</span>
<span class="sd">        Mean value of the Gaussian.</span>
<span class="sd">    width : `astropy.units.Quantity`</span>
<span class="sd">        Sigma width of the Gaussian line.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;MyCustomSpectralModel&quot;</span>
    <span class="n">amplitude</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">,</span> <span class="s2">&quot;1e-12 cm-2 s-1 TeV-1&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;reference&quot;</span><span class="p">,</span> <span class="s2">&quot;1 TeV&quot;</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;1 TeV&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;0.1 TeV&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">pwl</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
            <span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">,</span>
            <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gauss</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">energy</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">width</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pwl</span> <span class="o">+</span> <span class="n">gauss</span>
</pre></div>
</div>
</div>
<p>It is good practice to also implement a docstring for the model, defining the parameters and also definig a <code class="docutils literal notranslate"><span class="pre">tag</span></code>, which specifies the name of the model for serialisation. Also note that gammapy assumes that all SpectralModel evaluate functions return a flux in unit of <code class="docutils literal notranslate"><span class="pre">&quot;cm-2</span> <span class="pre">s-1</span> <span class="pre">TeV-1&quot;</span></code> (or equivalent dimensions).</p>
<p>This model can now be used as any other spectral model in Gammapy:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_custom_model</span> <span class="o">=</span> <span class="n">MyCustomSpectralModel</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="s2">&quot;3 TeV&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_custom_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_custom_model</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="mi">1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_custom_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">energy_bounds</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As a next step we can also register the custom model in the <code class="docutils literal notranslate"><span class="pre">SPECTRAL_MODELS</span></code> registry, so that it becomes available for serilisation:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SPECTRAL_MODEL_REGISTRY</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MyCustomSpectralModel</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">=</span><span class="n">my_custom_model</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;my-source&quot;</span><span class="p">)</span>
<span class="n">models</span> <span class="o">=</span> <span class="n">Models</span><span class="p">([</span><span class="n">model</span><span class="p">])</span>
<span class="n">models</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;my-custom-models.yaml&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>cat my-custom-models.yaml
</pre></div>
</div>
</div>
<p>Similarly you can also create custom spatial models and add them to the <code class="docutils literal notranslate"><span class="pre">SPATIAL_MODELS</span></code> registry. In that case gammapy assumes that the evaluate function return a normalized quantity in “sr-1” such as the model integral over the whole sky is one.</p>
</div>
<div class="section" id="Models-with-energy-dependent-morphology">
<h2>Models with energy dependent morphology<a class="headerlink" href="#Models-with-energy-dependent-morphology" title="Permalink to this headline">¶</a></h2>
<p>A common science case in the study of extended sources is to probe for energy dependent morphology, eg: in Supernova Remnants or Pulsar Wind Nebulae. Traditionally, this has been done by splitting the data into energy bands and doing individual fits of the morphology in these energy bands.</p>
<p><code class="docutils literal notranslate"><span class="pre">SkyModel</span></code> offers a natural framework to simultaneously model the energy and morphology, e.g. spatial extent described by a parametric model expression with energy dependent parameters.</p>
<p>The models shipped within gammapy use a “factorised” representation of the source model, where the spatial (<span class="math notranslate nohighlight">\(l,b\)</span>), energy (<span class="math notranslate nohighlight">\(E\)</span>) and time (<span class="math notranslate nohighlight">\(t\)</span>) dependence are independent model components and not correlated:</p>
<div class="math notranslate nohighlight">
\[f(l, b, E, t) = F(l, b) \cdot G(E) \cdot H(t)\]</div>
<p>To use full 3D models, ie $f(l, b, E) = F(l, b, E) <span class="math">\cdot `G(E) $, you have to implement your own custom ``SpatialModel`</span>. Note that it is still necessary to multiply by a <code class="docutils literal notranslate"><span class="pre">SpectralModel</span></code>, <span class="math notranslate nohighlight">\(G(E)\)</span> to be dimensionally consistent.</p>
<p>In this example, we create Gaussian Spatial Model with the extension varying with energy. For simplicity, we assume a linear dependence on energy and parameterize this by specifying the extension at 2 energies. You can add more complex dependences, probably motivated by physical models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gammapy.modeling.models</span> <span class="kn">import</span> <span class="n">SpatialModel</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates.angle_utilities</span> <span class="kn">import</span> <span class="n">angular_separation</span>


<span class="k">class</span> <span class="nc">MyCustomGaussianModel</span><span class="p">(</span><span class="n">SpatialModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;My custom Energy Dependent Gaussian model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lon_0, lat_0 : `~astropy.coordinates.Angle`</span>
<span class="sd">        Center position</span>
<span class="sd">    sigma_1TeV : `~astropy.coordinates.Angle`</span>
<span class="sd">        Width of the Gaussian at 1 TeV</span>
<span class="sd">    sigma_10TeV : `~astropy.coordinates.Angle`</span>
<span class="sd">        Width of the Gaussian at 10 TeV</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;MyCustomGaussianModel&quot;</span>
    <span class="n">is_energy_dependent</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;lon_0&quot;</span><span class="p">,</span> <span class="s2">&quot;0 deg&quot;</span><span class="p">)</span>
    <span class="n">lat_0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;lat_0&quot;</span><span class="p">,</span> <span class="s2">&quot;0 deg&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

    <span class="n">sigma_1TeV</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;sigma_1TeV&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0 deg&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sigma_10TeV</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="s2">&quot;sigma_10TeV&quot;</span><span class="p">,</span> <span class="s2">&quot;0.2 deg&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="p">,</span> <span class="n">sigma_1TeV</span><span class="p">,</span> <span class="n">sigma_10TeV</span><span class="p">):</span>

        <span class="n">sep</span> <span class="o">=</span> <span class="n">angular_separation</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="p">)</span>

        <span class="c1"># Compute sigma for the given energy using linear interpolation in log energy</span>
        <span class="n">sigma_nodes</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">([</span><span class="n">sigma_1TeV</span><span class="p">,</span> <span class="n">sigma_10TeV</span><span class="p">])</span>
        <span class="n">energy_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span>
        <span class="n">log_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma_nodes</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">log_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy_nodes</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;TeV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">log_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">energy</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;TeV&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">log_e</span><span class="p">,</span> <span class="n">log_en</span><span class="p">,</span> <span class="n">log_s</span><span class="p">))</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>

        <span class="n">exponent</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">sep</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">norm</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Serialisation of this model can be achieved as explained in the previous section. You can now use it as stadard <code class="docutils literal notranslate"><span class="pre">SpatialModel</span></code> in your analysis. Note that this is still a <code class="docutils literal notranslate"><span class="pre">SpatialModel</span></code>, and not a <code class="docutils literal notranslate"><span class="pre">SkyModel</span></code>, so it needs to be multiplied by a <code class="docutils literal notranslate"><span class="pre">SpectralModel</span></code> as before.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_model</span> <span class="o">=</span> <span class="n">MyCustomGaussianModel</span><span class="p">()</span>
<span class="n">spectral_model</span> <span class="o">=</span> <span class="n">PowerLawSpectralModel</span><span class="p">()</span>
<span class="n">sky_model</span> <span class="o">=</span> <span class="n">SkyModel</span><span class="p">(</span>
    <span class="n">spatial_model</span><span class="o">=</span><span class="n">spatial_model</span><span class="p">,</span> <span class="n">spectral_model</span><span class="o">=</span><span class="n">spectral_model</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_model</span><span class="o">.</span><span class="n">evaluation_radius</span>
</pre></div>
</div>
</div>
<p>To visualise it, we evaluate it on a 3D geom.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">energy_axis</span> <span class="o">=</span> <span class="n">MapAxis</span><span class="o">.</span><span class="n">from_energy_bounds</span><span class="p">(</span>
    <span class="n">energy_min</span><span class="o">=</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">energy_max</span><span class="o">=</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">TeV</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;energy_true&quot;</span>
<span class="p">)</span>
<span class="n">geom</span> <span class="o">=</span> <span class="n">WcsGeom</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">skydir</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">5.0</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">binsz</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">energy_axis</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">spatial_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span> <span class="n">add_cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span>
</pre></div>
</div>
</div>
<p>For computational purposes, it is useful to specify a <code class="docutils literal notranslate"><span class="pre">evaluation_radius</span></code> for <code class="docutils literal notranslate"><span class="pre">SpatialModels</span></code> - this gives a size on which to compute the model. Though optional, it is highly recommended for Custom Spatial Models. This can be done, for ex, by defining the following function inside the above class:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">evaluation_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Evaluation radius (`~astropy.coordinates.Angle`).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sigma_1TeV</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_10TeV</span><span class="o">.</span><span class="n">value</span><span class="p">])</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../../userguide/modeling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Modeling and Fitting (DL4 to DL5)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="fitting.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fitting</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, The Gammapy developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>